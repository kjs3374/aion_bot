import discord
from discord.ext import commands
import requests
import json
import openpyxl
import asyncio

client = discord.Client()
client = commands.Bot(command_prefix='!!') #접두사

@client.event
async def on_ready():
    global SID
    print(client.user.id)
    print("ready")
    SID = {}
    await client.change_presence(status=discord.Status.online, activity=discord.Game("검색 명령이 수정되었습니다.\n!!도움말 또는 !!명령어로 확인하세요."))

@client.command()
async def 도움말(ctx):
    helpEmbed = discord.Embed(title="검색 봇 도움말", description ="클래식 검색봇 명령어 리스트")
    helpEmbed.add_field(name="!!서버리스트",value="아이온클래식 전체 서버리스트 출력",inline=False)
    helpEmbed.add_field(name="!!서버",value="!!서버 [서버이름]\n검색할 서버설정\n설정전까지 동일 서버로 검색",inline=False)
    helpEmbed.add_field(name="!!현재서버",value="현재 설정되어있는 서버 출력",inline=False)
    helpEmbed.add_field(name="!!어비스템",value="어비스템 관련 어포/훈장 정보출력",inline=False)
    helpEmbed.add_field(name="!!검색",value="!!검색 [검색아이디1] [검색아이디2] ... [검색아이디...]\n띄어쓰기로 캐릭터명 구분\n입력한 캐릭터 명 만큼 검색",inline=False)
    await ctx.send(embed=helpEmbed)
    
@client.command()
async def 명령어(ctx):
    helpEmbed = discord.Embed(title="검색 봇 도움말", description ="클래식 검색봇 명령어 리스트")
    helpEmbed.add_field(name="!!서버리스트",value="아이온클래식 전체 서버리스트 출력",inline=False)
    helpEmbed.add_field(name="!!서버",value="!!서버 [서버이름]\n검색할 서버설정\n설정전까지 동일 서버로 검색",inline=False)
    helpEmbed.add_field(name="!!현재서버",value="현재 설정되어있는 서버 출력",inline=False)
    helpEmbed.add_field(name="!!어비스템",value="어비스템 관련 어포/훈장 정보출력",inline=False)
    helpEmbed.add_field(name="!!검색",value="!!검색 [검색아이디1] [검색아이디2] ... [검색아이디...]\n띄어쓰기로 캐릭터명 구분\n입력한 캐릭터 명 만큼 검색",inline=False)
    await ctx.send(embed=helpEmbed)
    
@client.command()
async def 현재서버 (ctx):

    global SID
    disServer = str(ctx.message.guild.id)
    

    try:
        serverName = SID[disServer][1]
        serverName != ""
    except:
        infotxt = "현재 적용중인 서버가 없습니다.\n서버를 설정해 주세요"
    else :
        infotxt = "현재 적용중인 서버는 {}서버 입니다.".format(serverName)
        
    #if serverName != "":
    #    infotxt = "현재 적용중인 서버는 {}서버 입니다.".format(serverName)
    #else :
    #    infotxt = "현재 적용중인 서버가 없습니다.\n서버를 설정해 주세요"
    SvInfo = discord.Embed(title="검색봇 현재연결서버", description="{}".format(infotxt))
    await ctx.send(embed=SvInfo)

@client.command()
async def 서버리스트 (ctx):
    SLembed = discord.Embed(title="아이온클래식 서버 리스트", description="이스라펠\n네자칸\n지켈\n바이젤\n트리니엘\n카이시넬\n루미엘")
    await ctx.send(embed=SLembed)

@client.command()
async def 서버(ctx,*,server):
    
    global SID

    serverName = server

    disServer = str(ctx.message.guild.id)        #디스코드 서버 고유 ID
    disServSet = {}                         #디스코드 서버별 SID
    
    serverList = "이스라펠,네자칸,지켈,바이젤,트리니엘,카이시넬,루미엘"
    if serverList.find(server) >= 0:
        await ctx.send("서버를 {}로 설정합니다.".format(server))
        #serverId 설정
        if serverName == "이스라펠" :
            disServSet[disServer]=[21]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "네자칸" :
            disServSet[disServer]=[22]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "지켈" :
            disServSet[disServer]=[23]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "바이젤" :
            disServSet[disServer]=[24]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "트리니엘" :
            disServSet[disServer]=[25]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "카이시넬" :
            disServSet[disServer]=[26]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        elif serverName == "루미엘" :
            disServSet[disServer]=[27]
            disServSet[disServer].append(serverName)
            SID.update(disServSet)
        else :
            disServSet[disServer]=[0]
            SID.update(disServSet)
    
    else :
        await ctx.send("서버를 설정할 수 없습니다.")
    #print("서버이름 : {}\n서버아이디 : {}".format(server,SID))
    #print(SID)
    #print(SID[disServer])
      
@client.command()
async def 검색(ctx,*,searchUsers):

    global SID
    
    
    disServer = str(ctx.message.guild.id)
    
    allUser = []
    user = []
    allUser = searchUsers.split()
    for user1 in allUser:
        user.append(user1)
        
    for userCnt in range(0,len(user)):
    
        #if SID[disServer][0] == 0:
        #    await ctx.send("서버설정을 먼저 해주시기 바랍니다.")
        try :
            SID[disServer][0] != 0
        except :
            await ctx.send("서버설정을 먼저 해주시기 바랍니다.")
        else:
            serverName = SID[disServer][1]
            url = 'https://api-aion.plaync.com/search/v1/characters?classId=&pageNo=1&pageSize=20&query={}&raceId=&serverId={}&site=aion&sort=rank&world=classic'.format(user[userCnt],SID[disServer][0])
            
        req = requests.get(url).content

    
        data = json.loads(req)

        uid = data.get("documents")[0].get("charId")
    
        #아이온 api 주소 + 캐릭터 ID
        srcurl = 'https://api-aion.plaync.com/game/v2/classic/merge/server/{}/id/{}'.format(SID[disServer][0],uid)
        basicinfo = 'https://api-aion.plaync.com/game/v2/classic/characters/server/{}/id/{}'.format(SID[disServer][0],uid)
        aionurl = 'https://aion.plaync.com/characters/server/{}/id/{}/home'.format(SID[disServer][0],uid)    
        #keyList
        payload = {'keyList' : ["character_stats","character_equipments","character_abyss","character_stigma"]}
    
        #아이온 api 호출
        reqsrc = requests.put(srcurl, json=payload).content
        basicsrc = requests.get(basicinfo).content
    
        #아이온 데이터 json 변환
        datasrc = json.loads(reqsrc)
        basicdata = json.loads(basicsrc)
    
    
        chrstat = datasrc['character_stats']
        #totstat = chrstat['totalStat']
        totstat = datasrc['character_stats']['totalStat']
        stigma = datasrc['character_stigma']
        equip = datasrc['character_equipments']
        rankName = datasrc['character_abyss']['rankName']
        totalKill = datasrc['character_abyss']['totalKillCount']
        className = basicdata.get('jobName')
        raceName = basicdata.get('raceName')
        guildName = basicdata.get('guildName')
        level = basicdata.get('level')
    
        stiName = []    #스티그마
        eqName = []     #장비이름
        eqInfo = []
        eqRing = []     #반지
        eqEar = []      #귀고리
        eqWp = []       #무기
        eqNec = []      #목걸이
        eqBelt = []     #허리띠
        eqSh = []       #어깨
        eqHand = []     #장갑
        eqFoot = []     #신발
        eqTorso = []    #상의
        eqLeg = []      #하의
        eqHead = []     #모자
        eqSheild = []   #방패
        eqWing = []     #날개
        
        for sti in stigma:
            stiName.append(sti['name'])
        
        for eq in equip:
        
            if eq['category1']['name'] == '장신구':
                eqAcc = eq['category2']['name']
                if eqAcc == '반지':
                    eqRing.append(eq['name'])
                elif eqAcc == '귀고리':
                    eqEar.append(eq['name'])
                elif eqAcc == '목걸이':
                    eqNec.append(eq['name'])
                elif eqAcc == '허리띠':
                    eqBelt.append(eq['name'])
            elif eq['category1']['name'] == '방어구':
                if eq['category3']['name'] == '어깨':
                    eqShName = eq['name']
                    eqShEn = eq['enchantCount']
                    eqSh.append("+ {} {}".format(eqShEn,eqShName))
                elif eq['category3']['name'] == '장갑':
                    eqHandName = eq['name']
                    eqHandEn = eq['enchantCount']
                    eqHand.append("+ {} {}".format(eqHandEn,eqHandName))
                elif eq['category3']['name'] == '신발':
                    eqFootName = eq['name']
                    eqFootEn = eq['enchantCount']
                    eqFoot.append("+ {} {}".format(eqFootEn,eqFootName))
                elif eq['category3']['name'] == '상의':
                    eqTorsoName = eq['name']
                    eqTorsoEn = eq['enchantCount']
                    eqTorso.append("+ {} {}".format(eqTorsoEn,eqTorsoName))
                elif eq['category3']['name'] == '하의':
                    eqLegName = eq['name']
                    eqLegEn = eq['enchantCount']
                    eqLeg.append("+ {} {}".format(eqLegEn,eqLegName))
                elif eq['category2']['name'] == '머리방어구':
                    eqHead.append(eq['name'])
                elif eq['category2']['name'] == '방패':
                    eqSheildName = eq['name']
                    eqShEn = (eq['enchantCount'])
                    eqSheild.append("+ {} {}".format(eqShEn,eqSheildName))
            elif eq['category1']['name'] == '무기':
                eqWeapon = (eq['name'])
                eqWpEn = (eq['enchantCount'])
                eqWeapon = "+ {} {}".format(eqWpEn,eqWeapon)
                eqWp.append(eqWeapon)
            elif eq['category1']['name'] == '날개':
                eqWing.append(eq['name'])
                
        
        #반지 확인
        if len(eqRing) == 2:
            eqRing1 = "반지 : {}".format(eqRing[0])
            eqRing2 = "반지 : {}".format(eqRing[1])
        elif len(eqRing) == 1:
            eqRing1 = "반지 : {}".format(eqRing[0])
            eqRing2 = "반지 : 없음"
        elif len(eqRing) == 0:
            eqRing1 = "반지 : 없음"
            eqRing2 = "반지 : 없음"
        
        #귀고리 확인
        if len(eqEar) == 2:
            eqEar1 = "귀고리 : {}".format(eqEar[0])
            eqEar2 = "귀고리 : {}".format(eqEar[1])
        elif len(eqEar) == 1:
            eqEar1 = "귀고리 : {}".format(eqEar[0])
            eqEar2 = "귀고리 : 없음"
        elif len(eqEar) == 0:
            eqEar1 = "귀고리 : 없음"
            eqEar2 = "귀고리 : 없음"

        #목걸이 확인
        if len(eqNec) == 1 :
            eqNecFin = "목걸이 : {}".format(eqNec[0])
        else : 
            eqNecFin = "목걸이 : 없음"
        
        #벨트 확인
        if len(eqBelt) == 1:
            eqBeltFin = "허리띠 : {}".format(eqBelt[0])
        else :
            eqBeltFin = "허리띠 : 없음"
        
        #어깨 확인
        if len(eqSh) == 1 :
            eqShFin = "어깨 : {}".format(eqSh[0])
        else :
            eqShFin = "어깨 : 없음"
        
        #장갑 확인
        if len(eqHand) == 1 :
            eqHandFin = "장갑 : {}".format(eqHand[0])
        else :
            eqHandFin = "장갑 : 없음"
        
        #신발 확인
        if len(eqFoot) == 1 :
            eqFootFin = "신발 : {}".format(eqFoot[0])
        else :
            eqFootFin = "신발 : 없음"
        
        #상의 확인
        if len(eqTorso) == 1:
            eqTorsoFin = "상의 : {}".format(eqTorso[0])
        else :
            eqTorsoFin = "상의 : 없음"
        
        #하의 확인
        if len(eqLeg) == 1:
            eqLegFin = "하의 : {}".format(eqLeg[0])
        else :
            eqLegFin = "하의 : 없음"
        
        #머리 확인
        if len(eqHead) == 1:
            eqHeadFin = "머리 : {}".format(eqHead[0])
        else :
            eqHeadFin = "머리 : 없음"
        
        #방패 확인
        if len(eqSheild) == 1 :
            eqSheildFin = "방패 : {}".format(eqSheild[0])
        else :
            eqSheildFin = "방패 : 없음"
            
        #날개 확인
        if len(eqWing) == 1 :
            eqWingFin = "날개 : {}".format(eqWing[0])
        else :
            eqWingFin = "날개 : 없음"

        #무기 확인
        if len(eqWp) == 4:
            eqWp1 = "무기 : {}".format(eqWp[0])
            eqWp2 = "무기 : {}".format(eqWp[1])
            eqWp3 = "무기 : {}".format(eqWp[2])
            eqWp4 = "무기 : {}".format(eqWp[3])
            eqWpFin = "{}\n{}\n{}\n{}".format(eqWp1,eqWp2,eqWp3,eqWp4)
        elif len(eqWp) == 3:
            eqWp1 = "무기 : {}".format(eqWp[0])
            eqWp2 = "무기 : {}".format(eqWp[1])
            eqWp3 = "무기 : {}".format(eqWp[2])
            eqWp4 = "무기 : 없음"
            eqWpFin = "{}\n{}\n{}".format(eqWp1,eqWp2,eqWp3)
        elif len(eqWp) == 2:
            eqWp1 = "무기 : {}".format(eqWp[0])
            eqWp2 = "무기 : {}".format(eqWp[1])
            eqWp3 = "무기 : 없음"
            eqWp4 = "무기 : 없음"
            eqWpFin = "{}\n{}".format(eqWp1,eqWp2)
        elif len(eqWp) == 1:
            eqWp1 = "무기 : {}".format(eqWp[0])
            eqWp2 = "무기 : 없음"
            eqWp3 = "무기 : 없음"
            eqWp4 = "무기 : 없음"
            eqWpFin = "{}".format(eqWp1)
        elif len(eqWp) == 0:
            eqWp1 = "무기 : 없음"
            eqWp2 = "무기 : 없음"
            eqWp3 = "무기 : 없음"
            eqWp4 = "무기 : 없음"
            eqWpFin = "무기 : 없음"

        #스티 확인
        if len(stiName) == 8:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "{}".format(stiName[3])
            sti5 = "{}".format(stiName[4])
            sti6 = "{}".format(stiName[5])
            sti7 = "{}".format(stiName[6])
            sti8 = "{}".format(stiName[7])
        elif len(stiName) == 7:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "{}".format(stiName[3])
            sti5 = "{}".format(stiName[4])
            sti6 = "{}".format(stiName[5])
            sti7 = "{}".format(stiName[6])
            sti8 = "없음"
        elif len(stiName) == 6:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "{}".format(stiName[3])
            sti5 = "{}".format(stiName[4])
            sti6 = "{}".format(stiName[5])
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 5:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "{}".format(stiName[3])
            sti5 = "{}".format(stiName[4])
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 4:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "{}".format(stiName[3])
            sti5 = "없음"
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 3:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "{}".format(stiName[2])
            sti4 = "없음"
            sti5 = "없음"
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 2:
            sti1 = "{}".format(stiName[0])
            sti2 = "{}".format(stiName[1])
            sti3 = "없음"
            sti4 = "없음"
            sti5 = "없음"
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 1:
            sti1 = "{}".format(stiName[0])
            sti2 = "없음"
            sti3 = "없음"
            sti4 = "없음"
            sti5 = "없음"
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"
        elif len(stiName) == 0:
            sti1 = "없음"
            sti2 = "없음"
            sti3 = "없음"
            sti4 = "없음"
            sti5 = "없음"
            sti6 = "없음"
            sti7 = "없음"
            sti8 = "없음"

        #변수 version 1 (21.05.03 이전)
        accuracy = totstat['accuracyRight']
        magicalAccuracy = totstat['magicalAccuracy']
        attack = totstat['physicalRight']
        hp = totstat['hp']
        magicResist = totstat['magicResist']
        critical = totstat['criticalRight']
        block = totstat['block']
        magicalBoost = totstat['magicalBoost']

        #변수 version 2 (21.05.03)
        nick = "{}".format(user[userCnt])
        className = "{}".format(className)
        level = "Lv{}".format(level)
        basic = nick + " / " + className + " / " + level
        raceName = "종족 : {}".format(raceName)
        guildName = "레기온 : {}".format(guildName)
        rankName = "어비스계급 : {}".format(rankName)
        totalKill = "전체킬수 : {}".format(totalKill)
        nowAp = "현재어포 : {}".format(datasrc['character_abyss']['abyssPoint'])
        todayKill = "금일킬수 : {}".format(datasrc['character_abyss']['todayKillCount'])
        todayAp = "금일어포 : {}".format(datasrc['character_abyss']['todayAbyssPoint'])
        twKill = "금주킬수 : {}".format(datasrc['character_abyss']['thisWeekKillCount'])
        twAp = "금주어포 : {}".format(datasrc['character_abyss']['thisWeekAbyssPoint'])
        lwKill = "전주킬수 : {}".format(datasrc['character_abyss']['lastWeekKillCount'])
        lwAp = "전주어포 : {}".format(datasrc['character_abyss']['lastWeekAbyssPoint'])
        hp = "생명력 : {}".format(hp)
        magicResist = "마법저항 : {}".format(magicResist)
        block = "방패방어 : {}".format(block)
        attack = "공격력 : {}".format(attack)
        accuracy = "명중 : {}".format(accuracy)
        critical = "물리치명타 : {}".format(critical)
        magicalBoost = "마법증폭력 : {}".format(magicalBoost)
        magicalAccuracy = "마법적중 : {}".format(magicalAccuracy)
        
        #pvp 추뎀 산출
        
        #반지1
        if eqRing1.find("십부장") >= 0:
            pvpRing1 = 1.6
            pvpRing1Chk = 10
        elif eqRing1.find("백부장") >= 0:
            pvpRing1 = 1.8
            pvpRing1Chk = 100
        elif eqRing1.find("천부장") >= 0:
            pvpRing1 = 2.0
            pvpRing1Chk = 1000
        else :
            pvpRing1 = 0
            pvpRing1Chk = 0
        
        #반지2
        if eqRing2.find("십부장") >= 0:
            pvpRing2 = 1.6
            pvpRing2Chk = 10
        elif eqRing2.find("백부장") >= 0:
            pvpRing2 = 1.8
            pvpRing2Chk = 100
        elif eqRing2.find("천부장") >= 0:
            pvpRing2 = 2.0
            pvpRing2Chk = 1000
        else :
            pvpRing2 = 0
            pvpRing2Chk = 0
        
        #귀고리1
        if eqEar1.find("십부장") >= 0:
            pvpEar1 = 2.4
            pvpEar1Chk = 10
        elif eqEar1.find("백부장") >= 0:
            pvpEar1 = 2.7
            pvpEar1Chk = 100
        elif eqEar1.find("천부장") >= 0:
            pvpEar1 = 3.0
            pvpEar1Chk = 1000
        else :
            pvpEar1 = 0
            pvpEar1Chk = 0

        #귀고리2
        if eqEar2.find("십부장") >= 0:
            pvpEar2 = 2.4
            pvpEar2Chk = 10
        elif eqEar2.find("백부장") >= 0:
            pvpEar2 = 2.7
            pvpEar2Chk = 100
        elif eqEar2.find("천부장") >= 0:
            pvpEar2 = 3.0
            pvpEar2Chk = 1000
        else :
            pvpEar2 = 0
            pvpEar2Chk = 0
        
        #목걸이
        if eqNecFin.find("십부장") >= 0:
            pvpNec = 3.2
            pvpNecChk = 10
        elif eqNecFin.find("백부장") >= 0:
            pvpNec = 3.6
            pvpNecChk = 100
        elif eqNecFin.find("천부장") >= 0:
            pvpNec = 4.0
            pvpNecChk = 1000
        else :
            pvpNec = 0
            pvpNecChk = 0
        
        #벨트
        if eqBeltFin.find("십부장") >= 0:
            pvpBelt = 1.6
            pvpBeltChk = 10
        elif eqBeltFin.find("백부장") >= 0:
            pvpBelt = 1.8
            pvpBeltChk = 100
        elif eqBeltFin.find("천부장") >= 0:
            pvpBelt = 2.0
            pvpBeltChk = 1000
        else :
            pvpBelt = 0
            pvpBeltChk = 1
        
        #무기
        
        #무기1
        if eqWp1.find("단도") >= 0:
            if eqWp1.find("십부") >= 0:
                pvpWp1 = 4.8
            elif eqWp1.find("백부") >= 0:
                pvpWp1 = 5.4
            elif eqWp1.find("천부") >= 0:
                pvpWp1 = 6.0
            else :
                pvpWp1 = 0
        elif eqWp1.find("검") >= 0:
            if eqWp1.find("십부") >= 0:
                pvpWp1 = 4.8
            elif eqWp1.find("백부") >= 0:
                pvpWp1 = 5.4
            elif eqWp1.find("천부") >= 0:
                pvpWp1 = 6.0
            else :
                pvpWp1 = 0 
        elif eqWp1.find("전투망치") >= 0:
            if eqWp1.find("십부") >= 0:
                pvpWp1 = 4.8
            elif eqWp1.find("백부") >= 0:
                pvpWp1 = 5.4
            elif eqWp1.find("천부") >= 0:
                pvpWp1 = 6.0
            else :
                pvpWp1 = 0 
        else :
            if eqWp1.find("십부") >= 0:
                pvpWp1 = 8.0
            elif eqWp1.find("백부") >= 0:
                pvpWp1 = 9.0
            elif eqWp1.find("천부") >= 0:
                pvpWp1 = 10.0
            else :
                pvpWp1 = 0 
        
        #무기2
        if eqWp2.find("단도") >= 0:
            if eqWp2.find("십부") >= 0:
                pvpWp2 = 4.8
            elif eqWp2.find("백부") >= 0:
                pvpWp2 = 5.4
            elif eqWp2.find("천부") >= 0:
                pvpWp2 = 6.0
            else :
                pvpWp2 = 0
        elif eqWp2.find("검") >= 0:
            if eqWp2.find("십부") >= 0:
                pvpWp2 = 4.8
            elif eqWp2.find("백부") >= 0:
                pvpWp2 = 5.4
            elif eqWp2.find("천부") >= 0:
                pvpWp2 = 6.0
            else :
                pvpWp2 = 0 
        elif eqWp2.find("전투망치") >= 0:
            if eqWp2.find("십부") >= 0:
                pvpWp2 = 4.8
            elif eqWp2.find("백부") >= 0:
                pvpWp2 = 5.4
            elif eqWp2.find("천부") >= 0:
                pvpWp2 = 6.0
            else :
                pvpWp2 = 0 
        else :
            if eqWp2.find("십부") >= 0:
                pvpWp2 = 8.0
            elif eqWp2.find("백부") >= 0:
                pvpWp2 = 9.0
            elif eqWp2.find("천부") >= 0:
                pvpWp2 = 10.0
            else :
                pvpWp2 = 0

        #무기3
        if eqWp3.find("단도") >= 0:
            if eqWp3.find("십부") >= 0:
                pvpWp3 = 4.8
            elif eqWp3.find("백부") >= 0:
                pvpWp3 = 5.4
            elif eqWp3.find("천부") >= 0:
                pvpWp3 = 6.0
            else :
                pvpWp3 = 0
        elif eqWp3.find("검") >= 0:
            if eqWp3.find("십부") >= 0:
                pvpWp3 = 4.8
            elif eqWp3.find("백부") >= 0:
                pvpWp3 = 5.4
            elif eqWp3.find("천부") >= 0:
                pvpWp3 = 6.0
            else :
                pvpWp3 = 0 
        elif eqWp3.find("전투망치") >= 0:
            if eqWp3.find("십부") >= 0:
                pvpWp3 = 4.8
            elif eqWp3.find("백부") >= 0:
                pvpWp3 = 5.4
            elif eqWp3.find("천부") >= 0:
                pvpWp3 = 6.0
            else :
                pvpWp3 = 0 
        else :
            if eqWp3.find("십부") >= 0:
                pvpWp3 = 8.0
            elif eqWp3.find("백부") >= 0:
                pvpWp3 = 9.0
            elif eqWp3.find("천부") >= 0:
                pvpWp3 = 10.0
            else :
                pvpWp3 = 0
        
        #무기4
        if eqWp4.find("단도") >= 0:
            if eqWp4.find("십부") >= 0:
                pvpWp4 = 4.8
            elif eqWp4.find("백부") >= 0:
                pvpWp4 = 5.4
            elif eqWp4.find("천부") >= 0:
                pvpWp4 = 6.0
            else :
                pvpWp4 = 0
        elif eqWp4.find("검") >= 0:
            if eqWp4.find("십부") >= 0:
                pvpWp4 = 4.8
            elif eqWp4.find("백부") >= 0:
                pvpWp4 = 5.4
            elif eqWp4.find("천부") >= 0:
                pvpWp4 = 6.0
            else :
                pvpWp4 = 0 
        elif eqWp4.find("전투망치") >= 0:
            if eqWp4.find("십부") >= 0:
                pvpWp4 = 4.8
            elif eqWp4.find("백부") >= 0:
                pvpWp4 = 5.4
            elif eqWp4.find("천부") >= 0:
                pvpWp4 = 6.0
            else :
                pvpWp4 = 0 
        else :
            if eqWp4.find("십부") >= 0:
                pvpWp4 = 8.0
            elif eqWp4.find("백부") >= 0:
                pvpWp4 = 9.0
            elif eqWp4.find("천부") >= 0:
                pvpWp4 = 10.0
            else :
                pvpWp4 = 0
            
            
        #pvp 방어 산출
        
        #상의
        if eqTorsoFin.find("십부") >= 0:
            pvpTorso = 4
            pvpTorsoChk = 10
        elif eqTorsoFin.find("백부") >= 0:
            pvpTorso = 4.5
            pvpTorsoChk = 100
        elif eqTorsoFin.find("천부") >= 0:
            pvpTorso = 5.0
            pvpTorsoChk = 1000
        else :
            pvpTorso = 0
            pvpTorsoChk = 0
        #하의
        if eqLegFin.find("십부") >= 0:
            pvpLeg = 3.2
            pvpLegChk = 10
        elif eqLegFin.find("백부") >= 0:
            pvpLeg = 3.6
            pvpLegChk = 100
        elif eqLegFin.find("천부") >= 0:
            pvpLeg = 4.0   
            pvpLegChk = 1000
        else :
            pvpLeg = 0
            pvpLegChk = 0

        #어깨
        if eqShFin.find("십부") >= 0:
            pvpSh = 2.4
            pvpShChk = 10
        elif eqShFin.find("백부") >= 0:
            pvpSh = 2.7
            pvpShChk = 100
        elif eqShFin.find("천부") >= 0:
            pvpSh = 3.0
            pvpShChk = 1000
        else :
            pvpSh = 0
            pvpShChk = 0
        
        #장갑
        if eqHandFin.find("십부") >= 0:
            pvpHand = 2.4
            pvpHandChk = 10
        elif eqHandFin.find("백부") >= 0:
            pvpHand = 2.7
            pvpHandChk = 100
        elif eqHandFin.find("천부") >= 0:
            pvpHand = 3.0
            pvpHandChk = 1000
        else :
            pvpHand = 0
            pvpHandChk = 0
        
        #신발
        if eqFootFin.find("십부") >= 0:
            pvpFoot = 2.4
            pvpFootChk = 10
        elif eqFootFin.find("백부") >= 0:
            pvpFoot = 2.7
            pvpFootChk = 100
        elif eqFootFin.find("천부") >= 0:
            pvpFoot = 3.0
            pvpFootChk = 1000
        else :
            pvpFoot = 0
            pvpFootChk = 0
        
        #머리
        if eqHeadFin.find("십부") >= 0:
            pvpHead = 1.6
            pvpHeadChk = 10
        elif eqHeadFin.find("백부") >= 0:
            pvpHead = 1.8
            pvpHeadChk = 100
        elif eqHeadFin.find("천부") >= 0:
            pvpHead = 2.0
            pvpHeadChk = 1000
        else :
            pvpHead = 0
            pvpHeadChk = 0
        
        #방패
        if eqSheildFin.find("십부") >= 0:
            pvpSheild = 4
        elif eqSheildFin.find("백부") >= 0:
            pvpSheild = 4.5
        elif eqSheildFin.find("천부") >= 0:
            pvpSheild = 5.0    
        else :
            pvpSheild = 0
        
        #pvp방어 합계
        pvpDef = pvpTorso + pvpLeg + pvpSh + pvpHand + pvpFoot + pvpHead + pvpSheild
        
        #pvp추뎀 합계
        pvpAcc = pvpRing1 + pvpRing2 + pvpEar1 + pvpEar2 + pvpNec + pvpBelt
        pvpAtt = pvpAcc + pvpWp1 + pvpWp2 + pvpWp3 + pvpWp4
        #if eqWp1.find("단도") >= 0 :
        #    pvpAtt = pvpAcc + pvpWp1 + pvpWp2
        #elif eqWp1.find("검") >= 0 :
        #    if eqSheildFin.find("없음") >= 0 :
        #    pvpAtt = pvpAcc + pvpWp1 + pvpWp2
        #    else :
        #    pvpAtt = pvpAcc + pvpWp1
        #elif eqWp1.find("전투망치") >= 0:
        #    if eqSheildFin.find("없음") >= 0 :
        #    pvpAtt = pvpAcc + pvpWp1 + pvpWp2
        #    else :
        #    pvpAtt = pvpAcc + pvpWp1
        
        pvpDef = round(pvpDef,2)
        pvpAtt = round(pvpAtt,2)
        pvpDefFin = "PVP 방어력 : {}%".format(pvpDef)
        pvpAttFin = "PVP 공격력 : {}%".format(pvpAtt)
        pvpInfo = "PVP 관련수치는 정확하지 않으니 참고만 부탁드립니다."
        
        #출력
        
        searchFin = "기본정보\n\n{}\n{}\n{}\n{}\n\
        \n\n스탯\n\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n\
        \n\n스티그마\n\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\
        \n\n장비\n\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\
        \n\nPVP추가수치\n\n{}\n{}\n{}\
        \n\n공식홈페이지 링크\n{}"\
        .format(basic,guildName,rankName,totalKill,hp,magicResist,block,attack,accuracy,critical,magicalBoost,magicalAccuracy,\
        sti1,sti2,sti3,sti4,sti5,sti6,sti7,sti8,\
        eqWp1,eqWp2,eqWp3,eqWp4,eqSheildFin,eqTorsoFin,eqShFin,eqLegFin,eqHandFin,eqFootFin,eqHeadFin,eqNecFin,eqEar1,eqEar2,eqRing1,eqRing2,eqBeltFin,\
        pvpAttFin,pvpDefFin,pvpInfo,aionurl)


        #await message.channel.send\
        #("기본정보\n닉네임 : {} \n클래스 : {}\n종족 : {} \n레기온 : {}\n어비스계급: {}\n전체 킬수: {}\n\
        #\n\n스탯\n\n생명력 : {} \n마법저항 : {} \n방패방어 : {}\n공격력 : {} \n명중 : {} \n물리치명타 : {}\n마법적중 : {} \
        #\n\n스티그마\n\n스티그마1 : {}\n스티그마2 : {}\n스티그마3 : {}\n스티그마4 : {}\n스티그마5 : {}\n스티그마6 : {}\n스티그마7 : {}\n스티그마8 : {} \
        #\n\n장비\n\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}"\
        #.format(user[userCnt],className,raceName,guildName,rankName,totalKill,hp,magicResist,block,attack,accuracy,critical,magicalAccuracy,\
        #stiName[0],stiName[1],stiName[2],stiName[3],stiName[4],stiName[5],stiName[6],stiName[7],\
        #eqWp1,eqWp2,eqWp3,eqSheild,eqTorso,eqSh,eqLeg,eqHand,eqFoot,eqHead,eqNec,eqEar1,eqEar2,eqRing1,eqRing2,eqBelt,aionurl))
        
        #await ctx.send(searchFin)
        
        className2 = className[:2]
        magicResChk = ""
        blockChk = ""
        magicalAcChk = ""
        magicBoostChk = ""
        pvpAccChk = pvpRing1Chk + pvpRing2Chk + pvpEar1Chk + pvpEar2Chk + pvpNecChk + pvpBeltChk
        pvpEqChk = pvpTorsoChk + pvpLegChk + pvpHandChk + pvpFootChk + pvpShChk
        eqEn = eqTorsoEn + eqLegEn + eqHandEn + eqFootEn + eqShEn
        
        #태그관련 변수확인
        tag = ""
        
        if int(totstat['magicResist']) >= 1600 :
            magicResChk = "마저 {}".format(className2)
            tag = tag + "**`#{}`** ".format(magicResChk)
        if int(totstat['block']) >= 2600 :
            blockChk = "방방 {}".format(className2)
            tag = tag + "**`#{}`** ".format(blockChk)
        if int(totstat['magicalAccuracy']) >= 1800 :
            magicalAcChk = "마적 {}".format(className2)
            tag = tag + "**`#{}`** ".format(magicalAcChk)
        if int(totstat['magicalBoost']) >= 2700 :
            magicBoostChk = "풀마증 {}".format(className2)
            tag = tag + "**`#{}`** ".format(magicBoostChk)
        
        if int(pvpAtt)>=10 and int(pvpAtt) <15:
            pvpAttChk = "pvp추뎀 10%이상"
            tag = tag + "**`#{}`** ".format(pvpAttChk)
        elif int(pvpAtt)>=15 and int(pvpAtt) <20:
            pvpAttChk = "pvp추뎀 15%이상"
            tag = tag + "**`#{}`** ".format(pvpAttChk)
        elif int(pvpAtt)>=20:
            pvpAttChk = "pvp추뎀 20%이상"
            tag = tag + "**`#{}`** ".format(pvpAttChk)
        
        if pvpEqChk == 50 :
            pvpEqType = "(정예)십부 풀방어구"
            tag = tag + "**`#{}`** ".format(pvpEqType)
        elif pvpEqChk == 500 :
            pvpEqType = "(정예)백부 풀방어구"
            tag = tag + "**`#{}`** ".format(pvpEqType)
        elif pvpEqChk == 5000 :
            pvpEqType = "(정예)천부 풀방어구"        
            tag = tag + "**`#{}`** ".format(pvpEqType)
        
        if eqEn >= 50:
            if eqTorsoEn >=15 and eqLegEn >=15 and eqHandEn >=15 and eqFootEn >=15 and eqShEn >= 15:
                eqEnTag = "전체 방어구 15강"
                tag = tag + "**`#{}`** ".format(eqEnTag)
            elif eqTorsoEn >=14 and eqLegEn >=14 and eqHandEn >=14 and eqFootEn >=14 and eqShEn >= 14:
                eqEnTag = "전체 방어구 14강 이상"
                tag = tag + "**`#{}`** ".format(eqEnTag)
            elif eqTorsoEn >=13 and eqLegEn >=13 and eqHandEn >=13 and eqFootEn >=13 and eqShEn >= 13:
                eqEnTag = "전체 방어구 13강 이상"
                tag = tag + "**`#{}`** ".format(eqEnTag)
            elif eqTorsoEn >=12 and eqLegEn >=12 and eqHandEn >=12 and eqFootEn >=12 and eqShEn >= 12:
                eqEnTag = "전체 방어구 12강 이상"
                tag = tag + "**`#{}`** ".format(eqEnTag)
            elif eqTorsoEn >=11 and eqLegEn >=11 and eqHandEn >=11 and eqFootEn >=11 and eqShEn >= 11:
                eqEnTag = "전체 방어구 11강 이상"
                tag = tag + "**`#{}`** ".format(eqEnTag)
            elif eqTorsoEn >=10 and eqLegEn >=10 and eqHandEn >=10 and eqFootEn >=10 and eqShEn >= 10:
                eqEnTag = "전체 방어구 10강 이상"
                tag = tag + "**`#{}`** ".format(eqEnTag)
        
        if tag == "":
            tag = "특이사항없음"
        file = openpyxl.load_workbook("nickname.xlsx")
        sheet = file.active
        for i in range(1,10000):
            if sheet["A"+str(i)].value == serverName and sheet["B"+str(i)].value == nick:
                charNick = sheet["C"+str(i)].value
                break
            else:
                charNick = 0
        #개인별명
        if charNick == 0:
            mainTit = "{} / {} / {} / {}".format(serverName,nick,className,level)
        else :
            mainTit = "{} / {} / {} / {}\n{}".format(serverName,nick,className,level,charNick)
        #if nick == "제천대성" :
        #    mainTit = "{} / {} / {} / {}\n변태 호법(마증 1900이하 로브님들 반성하세요)".format(serverName,nick,className,level)
        #if nick == "헬곰" :
        #    mainTit = "{} / {} / {} / {}\n헬스 궁성(3대 600이하 눈마주침 금지)".format(serverName,nick,className,level)
            
        ChrInfo = discord.Embed(title = mainTit, description="{} | {}".format(rankName,guildName),url=aionurl)
        ChrInfo.set_thumbnail(url="https://profileimg.plaync.com/game_profile_images/aion/images?gameServerKey={}&charKey={}".format(SID[disServer][0],uid))
        #ChrInfo.add_field(name="기본정보", value="{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}\nPVP 관련수치는 정확하지 않으니\n참고만 부탁드립니다.".format(nick,className,level,guildName,rankName,totalKill,pvpDefFin,pvpAttFin),inline = False)
        ChrInfo.add_field(name="주요능력치",value="{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}".format(hp,magicResist,block,attack,accuracy,critical,magicalBoost,magicalAccuracy),inline = True)
        ChrInfo.add_field(name="스티그마",value="{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}".format(sti1,sti2,sti3,sti4,sti5,sti6,sti7,sti8),inline=True)
        ChrInfo.add_field(name="어비스정보",value="{}\n{}\n{}\n{}\n{}\n{}\n{}".format(rankName,totalKill,nowAp,twKill,twAp,pvpAttFin,pvpDefFin),inline=True)
        #현재계급,전체킬,현재어포,오늘킬,오늘어포,이번주킬,이번주어포,지난주킬,지난주어포,pvp공,pvp방
        ChrInfo.add_field(name="장비",value="{}\n{}\n{}\n{}\n{}\n{}\n{}".format(eqWpFin,eqSheildFin,eqTorsoFin,eqShFin,eqLegFin,eqHandFin,eqFootFin),inline = False)
        ChrInfo.add_field(name="악세사리",value="{}\n{}\n{}\n{}\n{}\n{}\n{}\n{}".format(eqHeadFin,eqNecFin,eqEar1,eqEar2,eqRing1,eqRing2,eqBeltFin,eqWingFin),inline = False)
        if tag != "특이사항없음":
            ChrInfo.add_field(name="주요특징",value=tag,inline = False)
        await ctx.send(embed=ChrInfo)

@client.command()
async def 어비스템(ctx) :
    abyssEmbed = discord.Embed(title = "어비스아이템 정보",description = "필요 어비스포인트 (훈장 수)")
    abyssEmbed.add_field (name="십부장 장비",value="상의 : 117,300 (0)\n하의 : 88,000 (0)\n 어장신 : 58,700 (0)\n무기 : 175,900 (0)\n방패 : 117,300 (0)",inline = True)
    abyssEmbed.add_field (name="정예십부장 장비",value="상의 : 140,700 (9)\n하의 : 105,550 (7)\n 어장신 : 70,400 (5)\n무기 : 211,000 (14)\n방패 : 140,700 (9)",inline = True)
    abyssEmbed.add_field (name="십부장 악세",value="목걸이,머리 : 88,000 (0)\n귀걸이 : 66,000 (0)\n 반지,허리 : 44,000 (0)",inline = True)
    
    abyssEmbed.add_field (name="백부장 장비",value="상의 : 212,700 (36)\n하의 : 159,500 (27)\n 어장신 : 106,400 (18)\n무기 : 319,000 (53)\n방패 : 212,700 (36)",inline = True)
    abyssEmbed.add_field (name="정예백부장 장비",value="상의 : 319,000 (53)\n하의 : 239,200 (40)\n 어장신 : 159,500 (27)\n무기 : 478,400 (79)\n방패 : 319,000 (53)",inline = True)
    abyssEmbed.add_field (name="백부장 악세",value="목걸이,머리 : 159,500 (27)\n귀걸이 : 119,600 (20)\n 반지,허리 : 79,800 (14)",inline = True)
    
    abyssEmbed.add_field (name="천부장 장비",value="상의 : 409,900 (42)\n하의 : 307,400 (31)\n 어장신 : 205,000 (21)\n무기 : 614,800 (62)\n방패 : 409,900 (42)",inline = True)
    abyssEmbed.add_field (name="정예천부장 장비",value="상의 : 614,800 (62)\n하의 : 461,100 (47)\n 어장신 : 307,400 (31)\n무기 : 922,200 (93)\n방패 : 614,800 (62)",inline = True)
    abyssEmbed.add_field (name="천부장 악세",value="목걸이,머리 : 307,400 (31)\n귀걸이 : 230,600 (24)\n 반지,허리 : 153,700 (16)",inline = True)
    
    await ctx.send(embed=abyssEmbed)
    
@client.command()
async def 별명(ctx) :
    file = openpyxl.load_workbook("nickname.xlsx")
    sheet = file.active
    channel = ctx.channel
    serverList = "이스라펠,네자칸,지켈,바이젤,트리니엘,카이시넬,루미엘"
    
    def check(m):
        return m.author == ctx.author and m.channel == channel

    #별명 서버설정
    nickSetEmbed1 = discord.Embed(title = "별명 서버설정",description = "설정할 캐릭터의 서버를 입력하세요.")

    await ctx.send(embed=nickSetEmbed1)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        server = msg.content
        if serverList.find(server) >= 0:
            nickServer = server
        else:
            await ctx.send("서버설정에 실패하였습니다.\n다시 시도해 주세요")
            return

    #별명 닉네임설정
    nickSetEmbed2 = discord.Embed(title = "별명 캐릭터명설정",description = "설정할 캐릭터의 캐릭터명을 입력하세요.")

    await ctx.send(embed=nickSetEmbed2)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        nickChr = msg.content
    
    #별명 별명설정
    nickSetEmbed3 = discord.Embed(title = "별명 별명설정",description = "설정할 캐릭터의 별명을 입력하세요.")

    await ctx.send(embed=nickSetEmbed3)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        nickNick = msg.content

#    if len(nickInput) !=3:
#        await ctx.send("입력방식이 잘못되었습니다\n입력순서\n!!별명 서버/닉네임/별명(할말)")
#    else :
#        await ctx.send("별명삭제 또는 변경용 비밀번호를 입력하세요")
#        def check (m):
#            return m.author == ctx.author and m.channel == channel
#   
#        try:
#            msg = await client.wait_for('message',timeout=30.0, check=check)
#        except asyncio.TimeoutError:
#            await ctx.send("30초가 지나 종료합니다.")
#        else :
#            nickPass = msg.content
#            await msg.delete()
    
    
    for i in range(1,3000):
        if sheet["A"+str(i)].value == nickServer and sheet["B"+str(i)].value == nickChr :
            await ctx.send("이미 저장한 별명이 있습니다.")
            break
        else :
            if sheet["A"+str(i)].value == ".":
                sheet["A" + str(i)].value = nickServer      #서버
                sheet["B" + str(i)].value = nickChr         #캐릭터명
                sheet["C" + str(i)].value = nickNick        #별명
                await ctx.send("별명이 저장되었습니다.")
                break
    file.save("nickname.xlsx")

@client.command()
async def 별명삭제(ctx) :
    file = openpyxl.load_workbook("nickname.xlsx")
    sheet = file.active
    channel = ctx.channel
    serverList = "이스라펠,네자칸,지켈,바이젤,트리니엘,카이시넬,루미엘"
    
    def check(m):
        return m.author == ctx.author and m.channel == channel

    #별명 서버설정
    nickSetEmbed1 = discord.Embed(title = "별명삭제 서버설정",description = "별명을 삭제할 캐릭터의 서버를 입력하세요.")

    await ctx.send(embed=nickSetEmbed1)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        server = msg.content
        if serverList.find(server) >= 0:
            nickServer = server
        else:
            await ctx.send("서버설정에 실패하였습니다.\n다시 시도해 주세요")
            return

    #별명 닉네임설정
    nickSetEmbed2 = discord.Embed(title = "별명삭제 캐릭터명설정",description = "별명을 삭제할 캐릭터의 캐릭터명을 입력하세요.")

    await ctx.send(embed=nickSetEmbed2)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        nickChr = msg.content

#    for i in range(1,3000):
#        if sheet["A"+str(i)].value == nickServer and sheet["B"+str(i)].value == nickChr :
#            print("별명삭제 시퀀스")
#            channel = ctx.channel
#            nickSetEmbed3 = discord.Embed(title = "별명삭제 패스워드확인",description = "별명을 삭제할 캐릭터의 별명삭제 비밀번호를 입력하세요.")
#            await ctx.send(embed=nickSetEmbed3)
#            def check (m):
#                return m.author == ctx.author and m.channel == channel
#            try:
#                msg = await client.wait_for('message',timeout=30.0, check=check)
#            except asyncio.TimeoutError:
#                await ctx.send("30초가 지나 종료합니다.")
#            else :
#                if msg.content == nickNick or msg.content =="adminpassword1818":     #만능패스워드(관리자용)
#                    await msg.delete()
#                    sheet["A"+str(i)].value = "."
#                    sheet["B"+str(i)].value = ""
#                    sheet["C"+str(i)].value = ""
#                    await ctx.send("별명이 삭제되었습니다.")
#                else :
#                    await msg.delete()
#                    await ctx.send("변경/삭제용 패스워드가 맞지 않습니다.\n개발자에게 문의하세요.\n개발자 - 이스라펠 수배(검성)")
#                break

    for i in range(1,3000):
        if sheet["A"+str(i)].value == nickServer:
            if sheet["B"+str(i)].value == nickChr :
                sheet["A"+str(i)].value = "."
                sheet["B"+str(i)].value = ""
                sheet["C"+str(i)].value = ""
                await ctx.send("별명이 삭제되었습니다.")
                break

    file.save("nickname.xlsx")
@client.command()
async def 별명변경(ctx) :
    file = openpyxl.load_workbook("nickname.xlsx")
    sheet = file.active
    channel = ctx.channel
    serverList = "이스라펠,네자칸,지켈,바이젤,트리니엘,카이시넬,루미엘"
    
    def check(m):
        return m.author == ctx.author and m.channel == channel

    #별명 서버설정
    nickSetEmbed1 = discord.Embed(title = "별명변경 서버설정",description = "별명을 변경할 캐릭터의 서버를 입력하세요.")

    await ctx.send(embed=nickSetEmbed1)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        server = msg.content
        if serverList.find(server) >= 0:
            nickServer = server
        else:
            await ctx.send("서버설정에 실패하였습니다.\n다시 시도해 주세요")
            return

    #별명 닉네임설정
    nickSetEmbed2 = discord.Embed(title = "별명변경 캐릭터명설정",description = "별명을 변경할 캐릭터의 캐릭터명을 입력하세요.")

    await ctx.send(embed=nickSetEmbed2)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        nickChr = msg.content
    
    #별명 별명설정
    nickSetEmbed3 = discord.Embed(title = "별명변경 별명설정",description = "별명을 변경할 캐릭터의 별명을 입력하세요.")

    await ctx.send(embed=nickSetEmbed3)
    
    try:
        msg = await client.wait_for('message',timeout=30.0, check=check)
    except asyncio.TimeoutError:
        await ctx.send("30초가 지나 종료합니다.")
    else:
        nickNick = msg.content

#    for i in range(1,3000):
#        if sheet["A"+str(i)].value == nickServer and sheet["B"+str(i)].value == nickChr :
#            print("별명삭제 시퀀스")
#            channel = ctx.channel
#            nickSetEmbed3 = discord.Embed(title = "별명삭제 패스워드확인",description = "별명을 삭제할 캐릭터의 별명삭제 비밀번호를 입력하세요.")
#            await ctx.send(embed=nickSetEmbed3)
#            def check (m):
#                return m.author == ctx.author and m.channel == channel
#            try:
#                msg = await client.wait_for('message',timeout=30.0, check=check)
#            except asyncio.TimeoutError:
#                await ctx.send("30초가 지나 종료합니다.")
#            else :
#                if msg.content == nickChr or msg.content =="adminpassword1818":     #만능패스워드(관리자용)
#                    await msg.delete()
#                    sheet["C"+str(i)].value = nickNick
#                    await ctx.send("별명이 변경되었습니다.")
#                else :
#                    await msg.delete()
#                    await ctx.send("변경/삭제용 패스워드가 맞지 않습니다.\n개발자에게 문의하세요.\n개발자 - 이스라펠 수배(검성)")
#                break

    for i in range(1,3000):
        if sheet["A"+str(i)].value == nickServer:
            if sheet["B"+str(i)].value == nickChr :
                sheet["C"+str(i)].value = nickNick
                await ctx.send("별명이 변경되었습니다.")
                break

    file.save("nickname.xlsx")

#봇 코드
client.run('ODM2ODU2Mjk2OTc1MTA2MDg4.YIkFKQ.JV0Q4YuxRP7kMrsmf7TvSCALKZc')
